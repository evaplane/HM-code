<!DOCTYPE html>
<html lang="zh-cn">
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Bootstrap 101 Template</title>

    <!-- Bootstrap -->
    <link href="./lib/bootstrap/css/bootstrap.min.css" rel="stylesheet" />

    <!--
      HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries
    -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="http://cdn.bootcss.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="http://cdn.bootcss.com/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
    <style>
      .logout {
        font-weight: 900;
        font-size: 20px;
        color: #ff0000;
        text-decoration: none;
      }

      .logout:hover {
        text-decoration: none;
        color: yellowgreen;
      }
      .img-icon{
        width: 100px;
        height: 100px;
      }
    </style>
  </head>

  <body>
    <div class="container">
      <div class="row">
        <div class="col-md-12">
          <nav class="navbar navbar-default">
            <div class="container-fluid">
              <!-- Brand and toggle get grouped for better mobile display -->
              <div class="navbar-header">
                <button
                  type="button"
                  class="navbar-toggle collapsed"
                  data-toggle="collapse"
                  data-target="#bs-example-navbar-collapse-1"
                  aria-expanded="false"
                >
                  <span class="sr-only">Toggle navigation</span>
                  <span class="icon-bar"></span> <span class="icon-bar"></span>
                  <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="#">欢迎进入后台管理</a>
              </div>

              <!--
                Collect the nav links, forms, and other content for toggling
              -->
              <div
                class="collapse navbar-collapse"
                id="bs-example-navbar-collapse-1"
              >
                <p class="navbar-text navbar-right " style="font-weight: 700">
                  欢迎 【罗伯特】登录
                  <a href="" class="logout">退出</a>
                </p>
              </div>
              <!-- /.navbar-collapse -->
            </div>
            <!-- /.container-fluid -->
          </nav>
        </div>
      </div>
      <div class="row">
        <div class="col-md-12">
          <div class="panel panel-default">
            <div class="panel-heading">
              <ol class="breadcrumb">
                <li><a href="./index.html">首页</a></li>
                <li class="active">英雄编辑</li>
              </ol>
            </div>
            <div class="panel-body">
              <form action="#" method="" class="form-horizontal">
                <div class="form-group">
                  <label for="heroName" class="col-sm-2 control-label"
                    >姓名</label
                  >
                  <div class="col-sm-10">
                    <input
                      required
                      type="text"
                      class="form-control"
                      id="heroName"
                      name="heroName"
                      placeholder="请输入姓名"
                    />
                  </div>
                </div>
                <div class="form-group">
                  <label for="skillName" class="col-sm-2 control-label"
                    >技能</label
                  >
                  <div class="col-sm-10">
                    <input
                      required
                      type="text"
                      class="form-control"
                      id="skillName"
                      name="skillName"
                      placeholder="请输入技能"
                    />
                  </div>
                </div>
                <div class="form-group">
                  <label for="heroIcon" class="col-sm-2 control-label">头像</label>
                  <div class="col-sm-10">
                    <input
                      required
                      type="file"
                      class="form-control"
                      id="heroIcon"
                      name="heroIcon"
                    />
                    <img src="imgs/0592981558b798bc3d2fc1d30bf858b8" class='img-icon' alt="">
                  </div>
                </div>
                <div class="form-group">
                  <div class="col-sm-offset-2 col-sm-10">
                    <button type="submit" class="btn btn-default btn-save">
                      保存
                    </button>
                    <button type="submit" class="btn btn-cancel">取消</button>
                  </div>
                </div>
              </form>
            </div>
          </div>
        </div>
      </div>
    </div>
  </body>
</html>
<!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
<script src="./lib/js/jquery-1.12.4.js"></script>
<!--
  Include all compiled plugins (below), or include individual files as needed
-->
<script src="./lib/js/bootstrap.js"></script>
<script>
  $(function() {
    let id = "";
    getDetail();
    editDetail();
    //1.获取url传过来的id,获取detail,填入到表格里
    function getDetail() {
      id = location.search.split("=")[1];
      //1.1 发送ajax请求
      $.ajax({
        url: "heroDetail",
        data: { id },
        success: data => {
          // console.log(data);
          //1.2 将获取到的结果填到表格中
          $("input[name=heroName]").val(data.heroName);
          $("input[name=skillName]").val(data.skillName);

          //1.3 获取到头像,赋值给img的src
          $('.img-icon').attr('src',data.heroIcon);
        }
      });
    }

    //2.将修改好的数据添加到数据库中
    function editDetail() {
      //
      $(".btn-save").on("click", function() {
        //2.1 获取formData
        const fm = new FormData($("form")[0]);
        // console.log(id);
        fm.append("id",id);
        $.ajax({
          url: "heroUpdate",
          data: fm,
          contentType: false,
          processData: false,
          type: "post",
          success: data => {
            console.log(data);
            //如果修改成功
            if(data.msg){
              location='index.html';
            }
          }
        });

        return false;
      });
    }
  
    //3.点击取消
    function cancel(){
      $('.btn-cancel').on('click',function(){
        Window.location='index.html';
      })
    }
  
    //4.选择文件的预览效果,file的change事件中
    $("#heroIcon").on('change',function(e){
        // console.log(this.files);
        // const url = this.files[0];
        const url = URL.createObjectURL(this.files[0]);
        $('.img-icon').attr('src',url);
    })
  });
</script>
